#This code was used to generate alignments from raw ddRADSEQ data to be used in IQtree for Maximum Liklihood phylogeny construction
#Raw data is located here: https://www.ncbi.nlm.nih.gov/biosample?LinkName=bioproject_biosample_all&from_uid=1106052

######## All of the code was run a cluster #########
To generate alignment files I used ipyrad (https://ipyrad.readthedocs.io/en/master/)

ipyrad has a master control file that you alter/change based on how you would like to filter the data.

To generate a new master control file:

ipyrad -h ## generates a help file

ipyrad -n alignment_name # generates a new master control file with specficied name

#####below is the params file generated by the above code
##### The raw data files have already been demultiplexed and so just need to set the path to the sorted fastq
####Should not need the barcodes here
#### The following parameters need to be changed in order to obtain the same results from the study:

#7 -> pairddrad
#8 -> ATTC, CGG
#21 -> here we tested 3 different values and so three different alignments [4], [30], and [45] The alignment included on github is from 45 since the other two are too large to upload.
#25 -> 0, 100, 0, 100
#27 -> *

alignment_name                 ## [0] [assembly_name]: Assembly name. Used to name output directories for assembly steps
/AMS/combined/new_Samples_100 ## [1] [project_dir]: Project dir (made in curdir if not present)
                              ## [2] [raw_fastq_path]: Location of raw non-demultiplexed fastq files
                               ## [3] [barcodes_path]: Location of barcodes file
/pathway/to/sorted/fastq                                ## [4] [sorted_fastq_path]: Location of demultiplexed/sorted fastq files
denovo                         ## [5] [assembly_method]: Assembly method (denovo, reference)
                               ## [6] [reference_sequence]: Location of reference sequence file
rad                            ## [7] [datatype]: Datatype (see docs): rad, gbs, ddrad, etc.
TGCAG,                         ## [8] [restriction_overhang]: Restriction overhang (cut1,) or (cut1, cut2)
5                              ## [9] [max_low_qual_bases]: Max low quality base calls (Q<20) in a read
33                             ## [10] [phred_Qscore_offset]: phred Q score offset (33 is default and very standard)
6                              ## [11] [mindepth_statistical]: Min depth for statistical base calling
6                              ## [12] [mindepth_majrule]: Min depth for majority-rule base calling
10000                          ## [13] [maxdepth]: Max cluster depth within samples
0.85                           ## [14] [clust_threshold]: Clustering threshold for de novo assembly
0                              ## [15] [max_barcode_mismatch]: Max number of allowable mismatches in barcodes
2                              ## [16] [filter_adapters]: Filter for adapters/primers (1 or 2=stricter)
35                             ## [17] [filter_min_trim_len]: Min length of reads after adapter trim
2                              ## [18] [max_alleles_consens]: Max alleles per site in consensus sequences
0.05                           ## [19] [max_Ns_consens]: Max N's (uncalled bases) in consensus
0.05                           ## [20] [max_Hs_consens]: Max Hs (heterozygotes) in consensus
4                              ## [21] [min_samples_locus]: Min # samples per locus for output
0.2                            ## [22] [max_SNPs_locus]: Max # SNPs per locus
8                              ## [23] [max_Indels_locus]: Max # of indels per locus
0.5                            ## [24] [max_shared_Hs_locus]: Max # heterozygous sites per locus
0, 0, 0, 0                     ## [25] [trim_reads]: Trim raw read edges (R1>, <R1, R2>, <R2) (see docs)
0, 0, 0, 0                     ## [26] [trim_loci]: Trim locus edges (see docs) (R1>, <R1, R2>, <R2)
p, s, l                        ## [27] [output_formats]: Output formats (see docs)
                               ## [28] [pop_assign_file]: Path to population assignment file
                               ## [29] [reference_as_filter]: Reads mapped to this reference are removed in step 3


ipyrad was run using a slurm script and using this command
ipyrad -p  params-alignment_name.txt  -s 234567 -c 6
# -s 1 is not used becuase the files are already demultiplexed

Once ipyrad is finished running it will generate a number of different output files and alignment statistics - The stats are located in the alignment_name.stats.txt file. The file used for 
phylogenetic reconstruction will be a .phy file.


##### How to build a maximum likelihood tree using IQtree
This code was also ran on a cluster and thru a slurm script. It will perform a model test to search for the best model of nucleotide evolution and then using the best model create a maximum liklihood tree
with non parametric bootstrapping.

iqtree2 -s  alignment_name.phy -b 100 -m TEST  -T AUTO

Once the tree is finished running download the treefile and view it in a tree viewing program like figtree.
Please contact me if wanting to try and build a tree with the other alignment files that I was unable to upload due to size restrictions on github! 

